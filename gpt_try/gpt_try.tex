\documentclass{article}
\usepackage{amsmath,amsfonts,amssymb}
\begin{document}

\section{条件付き分布の導出}

\begin{align*}
q \left( x_{t+1} \mid x_t, x_0 \right) \text{の導出}
\end{align*}

\begin{align*}
q \left( x_{t-1} \mid x_t, x_0 \right) &= \frac{q \left( x_t, x_{t-1}, x_0 \right)}{q \left( x_t, x_0 \right)} \\
&= \frac{q \left( x_t \mid x_{t-1}, x_0 \right) q \left( x_{t-1}, x_0 \right)}{q \left( x_t, x_0 \right)} \\
&= \frac{q \left( x_t \mid x_{t-1}, x_0 \right) q \left( x_{t-1} \right) q \left( x_0 \right)}{q \left( x_t \right) q \left( x_0 \right)} \\
&= \frac{q \left( x_t \mid x_{t-1}, x_0 \right) q \left( x_{t-1} \right)}{q \left( x_t \right)} \\
&= \frac{q \left( x_t \mid x_{t-1} \right) q \left( x_{t-1} \right)}{q \left( x_t \right)}
\end{align*}

\begin{align*}
q \left( x_t \mid x_{t-1} \right) &= N \left( x_t ; \sqrt{\alpha_t} x_{t-1}, (1-\alpha_t) I \right)
\end{align*}

\begin{align*}
q \left( x_t \mid x_0 \right) &= N \left( x_t ; \sqrt{\alpha_t} x_0, (1-\alpha_t) I \right)
\end{align*}

\begin{align*}
q \left( x_{t+1} \mid x_t, x_0 \right) &= \frac{N \left( x_{t+1} ; \sqrt{\alpha_{t+1}} x_0, (1-\alpha_{t+1}) I \right) N \left( x_t ; \sqrt{\alpha_t} x_0, (1-\alpha_t) I \right)}{N \left( x_t ; \sqrt{\alpha_t} x_0, (1-\alpha_t) I \right)}
\end{align*}

\begin{align*}
&\propto \exp \left\{ -\frac{1}{2} \left( \frac{\| x_t - \sqrt{\alpha_t} x_{t-1} \|^2}{1-\alpha_t} + \frac{\| x_{t+1} - \sqrt{\alpha_{t+1}} x_0 \|^2}{1-\alpha_{t+1}} \right) \right\}
\end{align*}

\begin{align*}
&= \exp \left\{ -\frac{1}{2} \left( \frac{\alpha_t}{1-\alpha_t} + \frac{1}{1-\alpha_{t+1}} \right) \| x_{t+1} \|^2 \right\}
\end{align*}

\begin{align*}
&= \exp \left\{ -\frac{1}{2} \left( \frac{2 \sqrt{\alpha_t}}{1-\alpha_t} \right) x_{t+1} x_t + C \left( x_t, x_0 \right) \right\}
\end{align*}

\begin{align*}
&= \exp \left\{ -\frac{1}{2} \frac{\| x_{t+1} - \mu_{q \left( x_{t+1} \mid x_t, x_0 \right)} \|^2}{\sigma^2_{q \left( x_{t+1} \mid x_t, x_0 \right)}} \right\}
\end{align*}

\begin{align*}
\hat{\sigma}^2_{q \left( x_{t+1} \right)} &= \left( \frac{\alpha_t}{1-\alpha_t} + \frac{1}{1-\alpha_{t+1}} \right)^{-1} \\
&= \frac{\alpha_t (1-\alpha_{t+1}) + (1-\alpha_t)}{(1-\alpha_t)(1-\alpha_{t+1})} \\
&= \frac{(1-\alpha_t)(1-\alpha_{t+1})}{1-\alpha_t}
\end{align*}

\end{document}
